<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>Telegram Quest</title>

<style>
body {
    background-color: #6da273;
    background-image: url('https://raw.githubusercontent.com/tap-earn-bot/tap-earn-bot/main/telegram_pattern_hd.png');
    background-size: 450px;
    background-repeat: repeat;
    margin: 0;
    font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
    display: flex;
    flex-direction: column;
    height: 100vh;
    overflow: hidden;
}

/* HEADER */
.top-header {
    background: rgba(28, 28, 29, 0.98);
    padding: 12px 18px;
    display: flex;
    justify-content: space-between;
    align-items: center;
    color: white;
}
.close-btn { font-size: 16px; font-weight: 500; color: #248bcf; }
.header-title { font-size: 17px; font-weight: 700; }
.three-dots { font-size: 22px; font-weight: bold; }

/* PROGRESS */
.progress-box { width: 100%; height: 4.5px; background: #333; }
.progress-fill { width: 0%; height: 100%; background: #248bcf; transition: width 1s linear; }

/* VIEWPORT */
.viewport {
    flex-grow: 1;
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
}

.timer-overlay {
    background: rgba(255,255,255,0.15);
    color: white;
    padding: 6px 18px;
    border-radius: 22px;
    font-size: 18px;
    font-weight: 700;
    margin-bottom: 15px;
    border: 1px solid rgba(255,255,255,0.3);
    backdrop-filter: blur(10px);
}

/* POPUP CARD */
.popup-card {
    width: 90%;
    max-width: 340px;
    margin: 16px auto;
}

.ad-image {
    width: 100%;
    display: block;
    border-radius: 15px 15px 0 0;
}

/* WHITE TEXT */
.popup-text-box {
    background: #ffffff;
    color: #000;
    padding: 12px;
    font-size: 15px;
    font-weight: 500;
    text-align: center;
    border-radius: 0 0 10px 10px;
}

/* TELEGRAM GLASS BUTTON */
.tg-soft-btn {
    background: rgba(255,255,255,0.15);
    backdrop-filter: blur(6px);
    color: #ffffff;
    font-weight: 500;
    border: 1px solid rgba(255,255,255,0.25);
    border-radius: 14px;
    cursor: pointer;
    transition: all 0.2s ease;
}

.tg-big {
    width: 100%;
    padding: 14px 0;
    font-size: 17px;
    display: block;
    margin-top: 12px;
}

.tg-soft-btn:active {
    background: rgba(255,255,255,0.28);
    transform: scale(0.97);
}

/* BOTTOM */
.bottom-bar {
    background: white;
    padding: 20px;
    text-align: center;
}

.go-btn {
    background: #248bcf;
    color: white;
    width: 100%;
    max-width: 320px;
    padding: 15px;
    border-radius: 12px;
    font-size: 18px;
    font-weight: 800;
    border: none;
}

.go-btn:disabled { background: #b2d6ee; }

.powered-text {
    font-size: 11px;
    color: #999;
    margin-top: 12px;
}

body {
    background-color: #6da273;
    background-image: url('https://raw.githubusercontent.com/tap-earn-bot/tap-earn-bot/main/telegram_pattern_hd.png');
    background-size: 450px;
    background-repeat: repeat;
    margin: 0;
    font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
    display: flex;
    flex-direction: column;
    height: 100vh;
    overflow: hidden;
}

/* HEADER */
.top-header {
    background: rgba(28, 28, 29, 0.98);
    padding: 12px 18px;
    display: flex;
    justify-content: space-between;
    align-items: center;
    color: white;
}
.close-btn { font-size: 16px; font-weight: 500; color: #248bcf; }
.header-title { font-size: 17px; font-weight: 700; }
.three-dots { font-size: 22px; font-weight: bold; }

/* PROGRESS */
.progress-box { width: 100%; height: 4.5px; background: #333; }
.progress-fill { width: 0%; height: 100%; background: #248bcf; transition: width 1s linear; }

/* VIEWPORT */
.viewport {
    flex-grow: 1;
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
}

.timer-overlay {
    background: rgba(255,255,255,0.15);
    color: white;
    padding: 6px 18px;
    border-radius: 22px;
    font-size: 18px;
    font-weight: 700;
    margin-bottom: 15px;
    border: 1px solid rgba(255,255,255,0.3);
    backdrop-filter: blur(10px);
}

/* POPUP CARD */
.popup-card {
    width: 90%;
    max-width: 340px;
    margin: 16px auto;
}

.ad-image {
    width: 100%;
    display: block;
    border-radius: 15px 15px 0 0;
}

/* WHITE TEXT */
.popup-text-box {
    background: #ffffff;
    color: #000;
    padding: 12px;
    font-size: 15px;
    font-weight: 500;
    text-align: center;
    border-radius: 0 0 10px 10px;
}

/* TELEGRAM GLASS BUTTON */
.tg-soft-btn {
    background: rgba(255,255,255,0.15);
    backdrop-filter: blur(6px);
    color: #ffffff;
    font-weight: 500;
    border: 1px solid rgba(255,255,255,0.25);
    border-radius: 14px;
    cursor: pointer;
    transition: all 0.2s ease;
}

.tg-big {
    width: 100%;
    padding: 14px 0;
    font-size: 17px;
    display: block;
    margin-top: 12px;
}

.tg-soft-btn:active {
    background: rgba(255,255,255,0.28);
    transform: scale(0.97);
}

/* BOTTOM */
.bottom-bar {
    background: white;
    padding: 20px;
    text-align: center;
}

.go-btn {
    background: #248bcf;
    color: white;
    width: 100%;
    max-width: 320px;
    padding: 15px;
    border-radius: 12px;
    font-size: 18px;
    font-weight: 800;
    border: none;
}

.go-btn:disabled { background: #b2d6ee; }

.powered-text {
    font-size: 11px;
    color: #999;
    margin-top: 12px;
}
</style>
</head>
<body>

<div class="top-header">
    <div class="close-btn" onclick="handleClose()">Close</div>
    <div class="header-title">Verification Quest</div>
    <div class="three-dots">â‹®</div>
</div>

<div class="progress-box">
    <div id="pBar" class="progress-fill"></div>
</div>

<div class="viewport">
    <div id="timer" class="timer-overlay">00:30</div>

    <div class="popup-card">
        <img src="https://raw.githubusercontent.com/tap-earn-bot/tap-earn-bot/main/1771951780779.png" class="ad-image">
        <div class="popup-text-box">Reward claim karne ke liye tap karo</div>
        <button class="tg-soft-btn tg-big" id="claimBtn">CLAIM REWARD</button>
    </div>
</div>

<div class="bottom-bar">
    <button id="goBtn" class="go-btn" disabled>GO!</button>
    <div class="powered-text">Powered by Telegram Ad Platform</div>
</div>

<!-- Telegram WebApp Script -->
<script src="https://telegram.org/js/telegram-web-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-database.js"></script>

<script>
// ============ TELEGRAM INIT ============
const tg = window.Telegram?.WebApp;
if (tg) {
    tg.expand();
    tg.ready();
}

// ============ URL SE PARAMETERS ============
const urlParams = new URLSearchParams(window.location.search);
const userId = urlParams.get('userId') || 'guest';
const reward = urlParams.get('reward') || 10;
const timestamp = urlParams.get('timestamp');

console.log('User:', userId, 'Reward:', reward);

// ============ TIMER SETUP ============
let seconds = 30;
const pBar = document.getElementById('pBar');
const timerTxt = document.getElementById('timer');
const goBtn = document.getElementById('goBtn');
const claimBtn = document.getElementById('claimBtn');

// GO button initially disabled
goBtn.disabled = true;

// ============ CLAIM BUTTON (PROMOTIONAL LINK) ============
const promotionalLink = "https://t.me/your_channel"; // YAHAN APNA LINK DAALEIN

claimBtn.onclick = () => {
    if (tg) {
        tg.openLink(promotionalLink);
    } else {
        window.open(promotionalLink, '_blank');
    }
};

// ============ COUNTDOWN TIMER ============
const countdown = setInterval(() => {
    seconds--;

    let progress = ((30 - seconds) / 30) * 100;
    pBar.style.width = progress + "%";

    timerTxt.innerText = `00:${seconds < 10 ? '0' + seconds : seconds}`;

    if (seconds <= 0) {
        clearInterval(countdown);
        timerTxt.innerText = "DONE!";
        
        // Enable GO button
        goBtn.disabled = false;
    }
}, 1000);

// ============ GO BUTTON CLICK HANDLER ============
goBtn.onclick = function() {
    if (goBtn.disabled) return;
    
    // Redirect back to index with completion flag
    const redirectUrl = `../index.html?quest_completed=true&reward=${reward}&userId=${userId}&timestamp=${Date.now()}`;
    
    if (tg) {
        tg.openLink(redirectUrl);
    } else {
        window.location.href = redirectUrl;
    }
};

// ============ CLOSE HANDLER ============
function handleClose() {
    if (tg) {
        tg.close();
    } else {
        window.location.href = '../index.html';
    }
}
</script>
</body>
</html>
